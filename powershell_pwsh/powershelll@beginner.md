@[toc]

# powershell@ä½¿ç”¨æŒ‡å—ä¸å…¥é—¨å‘½ä»¤

##  ref

- learn by microsoft
  - [https://docs.microsoft.com/zh-cn/learn/paths/powershell/](https://docs.microsoft.com/zh-cn/learn/paths/powershell/)

- [æ–‡æ¡£å†…ç½®æ•™ç¨‹]:
  - [Discover PowerShell - PowerShell | Microsoft Docs](https://docs.microsoft.com/en-us/powershell/scripting/learn/tutorials/01-discover-powershell?view=powershell-7.2)

- [Learn and use PowerShell with just three commands - Tech Thoughts](https://www.techthoughts.info/learn-and-use-powershell-with-just-three-commands/)

## Learning PowershellğŸ˜Š

- [What is PowerShell? - PowerShell | Microsoft Learn](https://learn.microsoft.com/en-us/powershell/scripting/overview?view=powershell-7.3)
- [Introduction - PowerShell | Microsoft Learn](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/00-introduction?view=powershell-7.3)
  - [Introduction](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/00-introduction?view=powershell-7.3)
  - [Getting Started with PowerShell](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/01-getting-started?view=powershell-7.3)
  - [The Help System](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/02-help-system?view=powershell-7.3)
  - [Discovering objects, properties, and methods](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/03-discovering-objects?view=powershell-7.3)
  - [One-liners and the pipeline](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/04-pipelines?view=powershell-7.3)
  - [Formatting, aliases, providers, comparison](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/05-formatting-aliases-providers-comparison?view=powershell-7.3)
  - [Flow control](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/06-flow-control?view=powershell-7.3)
  - [Working with WMI](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/07-working-with-wmi?view=powershell-7.3)
  - [PowerShell remoting](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/08-powershell-remoting?view=powershell-7.3)
  - [Functions](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/09-functions?view=powershell-7.3)
  - [Script modules](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/10-script-modules?view=powershell-7.3)
  - [Appendix A - Help Syntax](https://learn.microsoft.com/en-us/powershell/scripting/learn/ps101/appendix-a?view=powershell-7.3)

##  è¯­è¨€è§„èŒƒå’Œè¯­è¨€å‚è€ƒ

[Windows PowerShell Language Specification 3.0 - PowerShell | Microsoft Docs](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-01?view=powershell-7.2)
* [1. Introduction](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-01?view=powershell-7.2)
* [2. Lexical Structure](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-02?view=powershell-7.2)
* [3. Basic concepts](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-03?view=powershell-7.2)
* [4. Types](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-04?view=powershell-7.2)
* [5. Variables](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-05?view=powershell-7.2)
* [6. Conversions](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-06?view=powershell-7.2)
* [7. Expressions](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-07?view=powershell-7.2)
* [8. Statements](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-08?view=powershell-7.2)
* [9. Arrays](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-09?view=powershell-7.2)
* [10. Hashtables](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-10?view=powershell-7.2)
* [11. Modules](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-11?view=powershell-7.2)
* [12. Attributes](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-12?view=powershell-7.2)
* [13. Cmdlets](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-13?view=powershell-7.2)
* [A. Comment-Based Help](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-14?view=powershell-7.2)
* [B. Grammar](https://docs.microsoft.com/en-us/powershell/scripting/lang-spec/chapter-15?view=powershell-7.2)

## cmdlet Reference



- CimCmdlets
- <u>Microsoft.PowerShell.Archive</u>
- <u>Microsoft.PowerShell.Core</u>
- Microsoft.PowerShell.Diagnostics
- Microsoft.PowerShell.Host
- <u>Microsoft.PowerShell.Management</u>
  - [PackageManagement](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/?view=powershell-7.3)
  - [Find-Package](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/find-package?view=powershell-7.3)
  - [Find-PackageProvider](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/find-packageprovider?view=powershell-7.3)
  - [Get-Package](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/get-package?view=powershell-7.3)
  - [Get-PackageProvider](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/get-packageprovider?view=powershell-7.3)
  - [Get-PackageSource](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/get-packagesource?view=powershell-7.3)
  - [Import-PackageProvider](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/import-packageprovider?view=powershell-7.3)
  - [Install-Package](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/install-package?view=powershell-7.3)
  - [Install-PackageProvider](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/install-packageprovider?view=powershell-7.3)
  - [Register-PackageSource](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/register-packagesource?view=powershell-7.3)
  - [Save-Package](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/save-package?view=powershell-7.3)
  - [Set-PackageSource](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/set-packagesource?view=powershell-7.3)
  - [Uninstall-Package](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/uninstall-package?view=powershell-7.3)
  - [Unregister-PackageSource](https://learn.microsoft.com/en-us/powershell/module/packagemanagement/unregister-packagesource?view=powershell-7.3)
- Microsoft.PowerShell.Security
- <u>Microsoft.PowerShell.Utility</u>
- Microsoft.WSMan.Management
- PackageManagement
- PowerShellGet
- PSDiagnostics
- <u>PSReadLine</u>
- ThreadJob


#  åŸºæœ¬å¸¸è¯†
- powershell å¤§å°å†™ä¸æ•æ„Ÿ,ä½†æ˜¯é¼“åŠ±è¯¥å¤§å†™çš„è¿˜æ˜¯å¤§å†™
-  powershellçš„å‘½ä»¤åæ˜¯`åŠ¨è¯-åç§°`å½¢å¼çš„
- é€šè¿‡`get-verb`å¯ä»¥è·å–powershellä¸­çš„åŠ¨è¯åˆ—è¡¨
- help å°†å¸®åŠ©åˆ†é¡µè€Œget-help ä¸ä¼šåˆ†é¡µ,è€Œåªæ˜¯å°†å†…å®¹å®Œå…¨è¾“å‡º
#  è·å–ç›¸å…³å‘½ä»¤
- ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒæ¨¡ç³Šæœç´¢(help/gcm)
- æˆ‘æ›´å–œæ¬¢ç”¨ `help`,è¿™æ˜¯ä¸ªæ›´åŠ é€šç”¨çš„å‘½ä»¤


##  æ–¹å¼1:get-help(help)
```ps1
PS C:\Users\cxxu_11> help File

Name                              Category  Module                    Synopsis
----                              --------  ------                    --------
New-PSSessionConfigurationFile    Cmdlet    Microsoft.PowerShell.Core Creates a file thatâ€¦
Test-PSSessionConfigurationFile   Cmdlet    Microsoft.PowerShell.Core     â€¦
Write-CFile                       Function  Carbon                    â€¦
Convert-CXmlFile                  Function  Carbon                    â€¦
Test-CFileShare                   Function  Carbon                    â€¦
Read-CFile                        Function  Carbon                    â€¦
Uninstall-CFileShare              Function  Carbon                    â€¦
Get-CFileSharePermission          Function  Carbon                    â€¦
Get-CFileShare                    Function  Carbon                    â€¦
...
about_Session_Configuration_Files HelpFile
```
- å¯¹æ¯” `get-command`


```ps1


PS C:\Users\cxxu_11> gcm *file*

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Function        Add-PoshGitToProfile                               1.0.0      posh-git
Function        ciscoFiles                                         0.0        jumpDirectoâ€¦
Function        Convert-CXmlFile                                   2.11.0     Carbon
Function        FileInfo                                           1.0.0.0    PSColor
Function        fritzingFiles                                      0.0        
Function        qqFiles                                            0.0        jumpDirectoâ€¦
Function        Read-CFile                                         2.11.0     Carbon
Function        Reset-CHostsFile                                   2.11.0     Carbon
...
              1.0.0.1    PowerShellGâ€¦
Function        wechatFiles                                        0.0        jumpDirectoâ€¦
Function        WINDOWS\â€¦
Application     openfiles.exe                                      10.0.2200â€¦ C:\WINDOWS\â€¦
Application     profiler.bat                                       0.0.0.0    D:\exes\andâ€¦
Application     profiler.exe                                       0.0.0.0    D:\exes\andâ€¦

```
##  æ–¹å¼2:get-command(gcm)
- æ¯”å¦‚è¦è·å–å’Œè¿›ç¨‹(process)ç›¸å…³çš„å‘½ä»¤:
  - `Get-Command *process*`

- è¿™é‡Œçš„`*`è¡¨ç¤ºé€šé…ç¬¦
- ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/79ca07930935462abadee30710da7abc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_20,color_FFFFFF,t_70,g_se,x_16)

#  powershellè¯­è¨€çš„è¯­æ³•å¸®åŠ©`about_`å¸®åŠ©ç³»ç»Ÿ
- ç”¨helpè·å–ç›¸å…³ä¸»é¢˜:
- ä¾‹å¦‚æ“ä½œç¬¦ç›¸å…³è¯­æ³•:
```ps1
PS C:\Users\cxxu_11> help operator

Name                              Category  Module                    Synopsis
----                              --------  ------                    --------
about_Arithmetic_Operators        HelpFile
about_Assignment_Operators        HelpFile
about_Comparison_Operators        HelpFile
about_Logical_Operators           HelpFile
about_Operators                   HelpFile
about_Operator_Precedence         HelpFile
about_Pipeline_Chain_Operators    HelpFile
about_Type_Operators              HelpFile
```
```ps1
PS C:\Users\cxxu_11> help about_Operators
                                                                                                ABOUT_OPERATORS
Short description
Describes the operators that are supported by PowerShell.
...
```

##  è·å–/æ›´æ–°å¸®åŠ©æ‰‹å†Œ

```
Update-Help
```
æŸäº›æƒ…å†µä¸‹,æ‚¨å¯èƒ½ä¼šæ”¶åˆ°é”™è¯¯,é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ”¹ä¸ºè¿è¡Œå¦‚ä¸‹æŒ‡ä»¤
æˆ–è€…å¦‚æœä½ æƒ³çœ‹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯è¯¦æƒ…:
	`Update-Help -Force -Verbose -ErrorAction SilentlyContinue`
å¯ä»¥å®‰å…¨åœ°å¿½ç•¥è¿™äº›é”™è¯¯ã€‚å®ƒä»¬ä¸ä¼šå½±å“PSåŠŸèƒ½æˆ–ä½¿ç”¨ã€‚
	`Get-Module -ListAvailable | Where HelpInfoUri |Update-Help`

##  è·å–æŸæ¡å‘½ä»¤çš„ä½¿ç”¨å¸®åŠ©/example

- è·å–å¸®åŠ©:
  - `help <commandName>`

- è¿™é‡Œmanå¯ä»¥æ›¿æ¢help(ä¸¤è€…éƒ½æ˜¯Get-Help)çš„åˆ«å
  - `<commandName> -?`

- cmdletçš„å¸®åŠ©é€‰é¡¹
  - `-example`
  - ç›¸æ¯”äºlinuxä¸­çš„man,pwshçš„`-example`é€‰é¡¹ç®—æ˜¯ä¸€ä¸ªäº®ç‚¹

- æ¯”å¦‚è·å–Stop-Process å‘½ä»¤çš„ç›¸å…³å¸®åŠ©
  - `Get-Help Stop-Process`

### ä¾‹

è·å–ç›¸å…³ç”¨æ³•ä¾‹å­`-example`

```
Get-Help Stop-Process -Examples
```

>â¯ Get-Help Stop-Process -Examples

>NAME
>Stop-Process

>SYNOPSIS
>Stops one or more running processes.


    ---------- Example 1: Stop all instances of a process ----------
    
    PS C:\> Stop-Process -Name "notepad"
    
    This command stops all instances of the Notepad process on the computer. Each instance of Notepad runs in its own process. It uses the Name parameter to specify the processes, all of
    which have the same name. If you were to use the Id parameter to stop the same processes, you would have to list the process IDs of each instance of Notepad.
    ------- Example 2: Stop a specific instance of a process -------
    
    PS C:\> Stop-Process -Id 3952 -Confirm -PassThru
    Confirm
    Are you sure you want to perform this action?
    Performing operation "Stop-Process" on Target "notepad (3952)".
    [Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help
    (default is "Y"):y
    Handles  NPM(K)    PM(K)      WS(K) VM(M)   CPU(s)     Id ProcessName
    -------  ------    -----      ----- -----   ------     -- -----------
    41       2      996       3212    31            3952 notepad
    
    This command stops a particular instance of the Notepad process. It uses the process ID, 3952, to identify the process. The Confirm parameter directs PowerShell to prompt you before
    it stops the process. Because the prompt includes the process namein addition to its ID, this is best practice. The PassThru parameter passes the process object to the formatter for
    display. Without this parameter, there would be no display after a Stop-Process command.
    --- Example 3: Stop a process and detect that it has stopped ---
    
    PS C:\> calc
    PS C:\> $p = Get-Process -Name "calc"
    PS C:\> Stop-Process -InputObject $p
    PS C:\> Get-Process | Where-Object {$_.HasExited}

#  è·å–å¯¹è±¡ç±»å‹/æˆå‘˜

`Get-Member`
ä»¥Get-Date ä¸ºä¾‹
```
Get-Date | `Get-Member`
```
ä½†æ˜¯,æ›´æœ‰ç”¨çš„æ˜¯`get-Member`è·å–å¯¹è±¡çš„ç±»å‹,ç„¶ååˆ©ç”¨`get-command`æ¥æŸ¥è¯¢å¯ä»¥æ“ä½œå¯¹åº”ç±»å‹çš„cmdlet
[learn:å‘ç°å¯¹è±¡](https://docs.microsoft.com/zh-cn/learn/modules/discover-commands/4-discover-objects)

ä¾‹å¦‚:

```powershell
PS D:\repos\blogs> Get-Process -Name '*edge'|Get-Member|select -First 5

   TypeName: System.Diagnostics.Process

Name    MemberType    Definition
----    ----------    ----------
Handles AliasProperty Handles = Handlecount
Name    AliasProperty Name = ProcessName
NPM     AliasProperty NPM = NonpagedSystemMemorySize64
PM      AliasProperty PM = PagedMemorySize64
SI      AliasProperty SI = SessionId
```

- ä¸ºèŠ‚çº¦ç¯‡å¹…,åªå±•ç¤ºå‰5è¡Œ

- æ³¨æ„`   TypeName: System.Diagnostics.Process`è¿™ä¸€è¡ŒæŒ‡å‡ºå‘½ä»¤è¡Œ`Get-Process -Name '*edge'`çš„è¿”å›ç»“æœå¯¹è±¡ç±»å‹

  

## æ ¹æ®å¯¹è±¡ç±»å‹æŸ¥è¯¢ç›¸å…³çš„æ–¹æ³•@æ“ä½œ

- å¾—åˆ°å¯¹è±¡ç±»å‹å,å¯èƒ½è¿˜éœ€è¦çŸ¥é“è¿™ä¸ªå¯¹è±¡å¯ä»¥åšä»€ä¹ˆæ“ä½œ:

- ```powershell
  PS D:\repos\blogs> Get-Command -ParameterType System.Diagnostics.Process
  
  CommandType     Name                                               Version    Source
  -----------     ----                                               -------    ------
  Cmdlet          Debug-Process                                      7.0.0.0    Microsoft.Pâ€¦
  Cmdlet          Enter-PSHostProcess                                7.3.1.500  Microsoft.Pâ€¦
  Cmdlet          Get-Process                                        7.0.0.0    Microsoft.Pâ€¦
  Cmdlet          Get-PSHostProcessInfo                              7.3.1.500  Microsoft.Pâ€¦
  Cmdlet          Stop-Process                                       7.0.0.0    Microsoft.Pâ€¦
  Cmdlet          Wait-Process
  ```

- ` Get-Command -ParameterType System.Diagnostics.Process`æŸ¥è¯¢`System.Diagnostics.Process`ç±»å‹çš„å¯¹è±¡å¯ä»¥æ‰§è¡Œé‚£äº›æ“ä½œ
  - ä¸Šé¢çš„ç»“æœå‘Šè¯‰æˆ‘ä»¬,å¯ä»¥æ‰§è¡Œ
    - `debug-process`
    - ....
    - `stop-process`
    - `wait-process`

#  å¤„ç†æ˜¾ç¤ºå†…å®¹(ä½¿ç”¨æ ¼å¼è®¾ç½®å’Œç­›é€‰)

- [learn link](https://docs.microsoft.com/zh-cn/learn/modules/connect-commands/4-format)
- ç±»ä¼¼äºæ•°æ®åº“,powershellæä¾›äº†ä¸€äº›æ ¼å¼åŒ–è¿”å›å†…å®¹çš„å·¥å…·å¯¹è±¡
- æ“ä½œåŸåˆ™:`æ­£ç¡®è®¾ç½®æ ¼å¼ï¼Œå°†æ ¼å¼è®¾ç½®ä½œä¸ºæœ€åä¸€é¡¹æ“ä½œ`
- é‰´äºç­›é€‰å·¦ä¾§åœ¨è¯­å¥ä¸­æ˜¯æŒ‡å°½å¯èƒ½æ—©åœ°ç­›é€‰å‡ºå†…å®¹ï¼Œä»å³å¾€å·¦æ ¼å¼åŒ–æ•°æ®åœ¨è¯­å¥ä¸­å°±æ˜¯æŒ‡å°½å¯èƒ½æ™šåœ°æ ¼å¼åŒ–æ•°æ®ã€‚ ä½†ä¸ºä»€ä¹ˆéœ€è¦å»¶è¿Ÿè®¾ç½®æ ¼å¼ï¼Ÿ åŸå› æ˜¯æ ¼å¼è®¾ç½®å‘½ä»¤å°†å¯¹è±¡æ›´æ”¹ä¸ºæ ¼å¼å¯¹è±¡ã€‚ è¿™æ„å‘³ç€æ•°æ®ä¸å†ä½äºç›¸åŒçš„å±æ€§å’Œæ–¹æ³•ä¸­ã€‚(æ ¼å¼è®¾ç½®ä¼šç ´åä½ æ­£åœ¨å¤„ç†çš„å¯¹è±¡ã€‚)
- `Get-Process | Where-Object CPU -gt 2 | Sort-Object CPU -Descending | Select-Object -First 3`
- ä¸Šè¿°å‘½ä»¤åˆ†åˆ«æ¶‰åŠåˆ°è®°å½•ç­›é€‰,æ’åºä»¥åŠåˆ—(æŠ•å½±),æ¥è·å–æ›´æœ‰é’ˆå¯¹æ€§çš„æŸ¥è¯¢(æ“ä½œ)ç»“æœ







