@[toc]

## 海明(汉明)(Haiming code)校验码

* 海明码是广泛采用的一种有效的校验码，它实际上是一种 `多重奇偶`校验码。

* 其实现原理是

  * 在**有效信息位**(数据码)中加入**几个校验位**形成**海明码**
  * 并把**海明码**的 <u>每个二进制位</u>分配到几个**奇偶校验组**中

* 当某一位出错后，就会 `引起有关的几个校验位的值发生变化`，

  * 这不但可以发现**错位**存在

  * 还能指出**错位的位置**，为**自动纠错**提供依据

* 根据纠错理论得

  * $$
    L一1=D+C
    \\(L=D+C+1)
    \\C\leq D
    $$




  * 即编码 `最小码距L`越大，
    * 其检测 `错误的位数D`越大
    * `纠正错误的位数C`也越大，
    * **纠错能力恒小于等于检错能力**

  * 海明码就是根据这一理论提出的**具有纠错能力的一种编码**。


## 码距

- 在[信息编码](https://baike.baidu.com/item/信息编码/9637385?fromModule=lemma_inlink)中，两个合法[代码](https://baike.baidu.com/item/代码/86048?fromModule=lemma_inlink)对应位上[编码](https://baike.baidu.com/item/编码/80092?fromModule=lemma_inlink)不同的[位数](https://baike.baidu.com/item/位数/6281904?fromModule=lemma_inlink)称为[码距](https://baike.baidu.com/item/码距/5907009?fromModule=lemma_inlink)，又称海明距离
  - 10101和00110从第一位开始依次有第一位、第四、第五位不同，则海明距离为D=3。

### 检测d个错误

- 为了**检测d个错误**，需要一个海明距离为$D_{detect}=d+1$的**编码方案**
- 因为在这样的编码方案中，d个1位错误不可能将一个有效码字改编成另一个有效码字。
- 当接收方看到一个无效码字的时候，它就知道已经发生了传输错误。

### 纠正d个错误

- 类似地，为了纠正d个错误，需要一个距离为$D_{correct}=2d+1$的**编码方案**，
- 因为在这样的编码方案中，**合法码字之间的距离足够远**，
  - 因而即使发生了d位变化，则还是原来的码字离它最近，
  - 从而可以确定原来的码字，达到纠错的目的

#### 例

- 为了**纠正**2bit的错误,编码的海明距为:
  - 海明码纠错的位数记为d
  - 则码距为$D=2d+1$的编码方案

### 海明码的位数

- 根据公式确定符合要求的海明码位数

- 设$n$为有效信息的位数，$k$为校验位的位数,满足

  - 检错1位:

    - $n+k ≤ 2^k -1$

      - $n=0,1,2,\cdots$

      - $k=0,1,2,\cdots$
        - 通常,$k\geqslant2$,不过在这个阶段我们暂且把0,1也考虑进去

    - $n\leqslant{2^k}-k-1$

      - | k    | $y(k)=2^k-k-1$ | k位校验码可以应对的有效位n的上限(一位检错) | 范围(推荐) |
        | ---- | -------------- | ------------------------------------------ | ---------- |
        | 0    | 1-0-1=0        | 0                                          | 0          |
        | 1    | 2-1-1=0        | 0                                          | 0          |
        | 2    | 4-2-1=1        | 1                                          | [0,1]      |
        | 3    | 8-3-1=4        | 4                                          | [2,4]      |
        | 4    | 16-4-1=11      | 11                                         | [5,11]     |
        | 5    | 32-5-1=26      | 26                                         | [12,26]    |
        | 6    | 64-6-1=57      | 57                                         | [27,57]    |
        | 7    | 128-7-1=120    | 120                                        | [58,120]   |
        | ...  | ...            | ...                                        | ...        |

      - 一般来讲,k=4已经足够应付一般的问题(可以校验11)

    - 为了使用上的方便,将n作为索引关键字查表

      - 列出表格的前几项也容易

      - | n的范围(数据码的位数) | 对应需要的校验位k(下限) |
        | --------------------- | ----------------------- |
        | [0,1]                 | 2                       |
        | [2,4]                 | 3                       |
        | [5,11]                | 4                       |
        | [12,26]               | 5                       |
        | [27,57]               | 6                       |
        | [58,120]              | 7                       |
        | ...                   | ...                     |

  - 要检测两位错，则需再增加1位校验位，即$k＋1$位


- 确定k的原则
  - k值在满足要求的情况下尽量的小,可以取m,就不要取m+1或者更大的数

#### 例

- 🎈设
  - 数据码D的各个位上的二进制值$D=D_n\cdots{D_1};$
  - **海明码位数**为$s=n+k$🎈
  - D的海明码表示为$H=H(D)=H_{s},\cdots{,H_{n+1},H_n},\cdots{,H_1}$
- $例如取D=1011$,$n=4$,作为例子
- 确定k(从给定的条件已经知道n=4)
  - 方法1:自行建立表,查表得知,k=3比较合适
  - 方法2:试探法(凭借经验,不是从k=1开始试探,而直接从某个大于0的值开始试探)
    - 可以结合二分查找,确定k,
    - 海明码位数为$n+k=7≤2^3-1$成立，则$k=3$恰好满足要求


- 设信息位为$D_4;D_3,D_2,D_1$;(D=1010),共4位，

- 校验位为$P_3,P_2,P_1$，共3位，

- 则对应的**海明码**(海明码位**串**)为H(D)=$H_7H_6H_5H_4H_3H_2H_1$


  - 容易看出表达式,$H_i$的含义:

- $其中i的可能取值:i=1,2,\cdots{n+k}$

- 这里的$H_i$表示**海明位**的各个二进制位数码的**取值**(Hamming)

- 而下标$i$表示**海明位序号**(位置)

- 例如某个海明码$H=1010010$

  - | 海明位序号(索引) | 7     | 6     | 5     | 4     | 3     | 2     | 1     |
    | ---------------- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
    | 海明位           | $H_7$ | $H_6$ | $H_5$ | $H_4$ | $H_3$ | $H_2$ | $H_1$ |
    | 取值             | 1     | 0     | 1     | 0     | 0     | 1     | 0     |


​      


### 确定校验位的分布

- 规定校验位$P_i$在`海明位号`为$2^{i-1}$的位置上

- 其余的海明位是信息位

- 可以这样类比

  - 海明号作为座位(椅子)的编号
  - 海明码中的**校验位**和**信息位**分别类比位保安和游客

- 我们需要计算出k个保安应该就位到那些海明号(作为$H_i$的值)

  - 譬如,$i$号校验码($P_i$)需要放在$2^{i-1}$的位置上

    - 两套编号系统的一个映射函数(对应关系)$site(P_i)$=$2^{i-1}$
    - 为了简化书写,用函数$j=j(i)=2^{i-1}$表示映射关系

  - 下表中$i=1,\cdots,k$,分别指示k位校验位的每个位

  - | i    | $q=i-1$(这一列可有可无) | $j=2^q=2^{i-1}$ |
    | ---- | ----------------------- | --------------- |
    | 1    | 0                       | 1               |
    | 2    | 1                       | 2               |
    | 3    | 2                       | 4               |
    | 4    | 3                       | 8               |
    | ...  | ...                     | ...             |
    | k    | k-1                     | $2^{k-1}$       |

  - 由映射公式容易发现校验位的分布位置(序号之间)满足等比数列

- 安排完校验位后,其余位($H_i$)用 信息位$D_i$插入(按原信息位的序列顺序)

  - | 海明位序号(索引)                 | 7     | 6     | 5     | 4     | 3     | 2     | 1     |
    | -------------------------------- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
    | 海明位                           | $H_7$ | $H_6$ | $H_5$ | $H_4$ | $H_3$ | $H_2$ | $H_1$ |
    | 校验位分布(位置)                 |       |       |       | $P_3$ |       | $P_2$ | $P_1$ |
    | 信息位分布(位置)                 | $D_4$ | $D_3$ | $D_2$ |       | $D_1$ |       |       |
    | 综上各位取值(校验位具体取值待求) | 1     | 0     | 1     |       | 0     |       |       |



### 分组以形成校验关系

- 每个数据位$D_i$用`多个校验位`($P_i$)进行校验

  - **多个**表示,至少2个校验位(所以一般用到海明码的环境下,$k\geqslant{2}$)

  - 为了便于讨论,称对于数据位(有效信息位)的校验行为**校验任务**,简称`任务`

  - 假设某个校验任务中使用了u个校验位

  - 这u个校验位满足条件:

    - 被校验数据位的`海明位号`等于`校验该数据位的各校验位`的`海明位号之和`
    - 这里强调的是`海明号之和`;也就是海明码在海明号序列下的下标之和之间的约束关系

  - | Note:column header;$j(校验位P_i所在的海明位位置下标j=2^{i-1})$ | 1    | 2    | 4    | ...  | $2^{k-1}$ |
    | ------------------------------------------------------------ | ---- | ---- | ---- | ---- | --------- |
    | case1                                                        |      |      |      |      |           |
    | case2                                                        |      |      |      |      |           |
    | case3                                                        |      |      |      |      |           |
    | ...                                                          |      |      |      |      |           |
    | cases$(2^{k}-k-1)$                                           |      |      |      |      |           |

    - 这个表格设计的不是很好,有空在研究
      - case也可记作task
      - 表头的"$j(校验位P_i所在的海明位位置下标)$"这个应该放在$1,2,4,\cdots,2^{k-1}$上面
      - 但是markdown表格比较简单,且为了能够兼容latex,所以挪到左侧
    - 也可以画树状图
    - 根据组合数来做,最直接
    
  - 根据排列组合的知识:

    - 如果有k个校验位,则可以分配(搭配)的校验任务数**上限**🎈

      - $$
        U=\sum_{i=2}^{k}\binom{k}{i}
        =\binom{k}{2}+\binom{k}{3}+\cdots+\binom{k}{k}
        =\sum_{i=1}^{k}\binom{k}{i}-\sum_{i=2}^{k}\binom{k}{i}
        =2^{k}-k-1
        $$

      - 这个结论部分回答了为什么最初的n,k不等式的关系形式

  - 回到本例

    - $C_3^2=3,C_3^{3}=1,共有3+1=4个校验任务$

      - 这恰好就是信息位的位数n=4
      - 只有当上限值$U\geqslant{n}$,才能够保证,所有信息位都可以被校验!(分配到校验任务)
    
    - $1+2=3$,所以$H_1,H_2校验H_3$,$H_3=D_1$
    
    - $1+4=5$,所以$H_1,H_4$校验$H_5$,$H_5=D_2$
    
    - $2+4=6$,所以$H_2,H_4$校验$H_6$,$H_6=D_3$
    
    - $1+2+4=7$,所以$H_1,H_2,H_4$校验$H_7$,$H_7=D_4$
    
    - | 海明位序号(索引)   | 7                       | 6                   | 5                   | 4     | 3                     | 2     | 1     |
      | ------------------ | ----------------------- | ------------------- | ------------------- | ----- | --------------------- | ----- | ----- |
      | 海明位             | $H_7$                   | $H_6$               | $H_5$               | $H_4$ | $H_3$                 | $H_2$ | $H_1$ |
      | 校验位分布(位置)   |                         |                     |                     | $P_3$ |                       | $P_2$ | $P_1$ |
      | 信息位分布(位置)   | $D_4$                   | $D_3$               | $D_2$               |       | $D_1$                 |       |       |
      | 信息位校验任务分配 | $H_{(1,2,4)}=P_{1,2,3}$ | $H_{(2,4)}=P_{2,3}$ | $H_{(1,4)}=P_{1,3}$ |       | $H_{(1,2)}=P_{1,2,3}$ |       |       |

- 校验位不需要再被校验🎈


#### 根据校验位分组

- ![在这里插入图片描述](https://img-blog.csdnimg.cn/a3ff1aea13e843ef90dce95a90628103.png)
  - 从各个校验位的角度来看
    - 每个校验位被分配了若干任务,称为校验位$P_i$的任务组
    - 每个需要被校验的信息位需要若干个(2个以上的)校验位提供校验基础




### 求解校验位取值



- | 海明位序号(索引)                     | 7                       | 6                   | 5                   | 4           | 3                   | 2           | 1           |
  | ------------------------------------ | ----------------------- | ------------------- | ------------------- | ----------- | ------------------- | ----------- | ----------- |
  | 海明位                               | $H_7$                   | $H_6$               | $H_5$               | $H_4$       | $H_3$               | $H_2$       | $H_1$       |
  | 校验位分布(位置)                     |                         |                     |                     | $P_3$       |                     | $P_2$       | $P_1$       |
  | 信息位分布(位置)                     | $D_4$                   | $D_3$               | $D_2$               |             | $D_1$               |             |             |
  | 信息位取值                           | 1                       | 0                   | 1                   |             | 0                   |             |             |
  | 信息位校验任务(包含的海明位/校验位)  | $H_{(1,2,4)}=P_{1,2,3}$ | $H_{(2,4)}=P_{2,3}$ | $H_{(1,4)}=P_{1,3}$ |             | $H_{(1,2)}=P_{1,2}$ |             |             |
  | 校验位分组(参与校验的信息位)(统计量) |                         |                     |                     | $D_{2,3,4}$ |                     | $D_{1,3,4}$ | $D_{1,2,4}$ |

- 根据各个**校验位**所参与的校验组**校验位的值**

- 校验位$P_i$的值为**第`i`组信息位**所有组内位求**异或**
  - 第i组<u>信息位组</u>是指:由校验位$P_i$参与校验的数据位

- 本步骤中获得完整海明码

#### 校验位取值

- 取D=$D_4,D_3,D_2,D_1$=1010

  - | $D_4$ | $D_3$ | $D_2$ | $D_1$ |
    | ----- | ----- | ----- | ----- |
    | 1     | 0     | 1     | 0     |

    

- 校验位$P_i$的值为第i组(由该校验位校验的数据位)**所有位求异或**(XOR)


$$
根据上述的分组有\\
\begin{array}{l}
P_{1}=D_{1} \oplus D_{2} \oplus D_{4}=0 \oplus 1 \oplus 1=0 \\
P_{2}=D_{1} \oplus D_{3} \oplus D_{4}=0 \oplus 0 \oplus 1=1 \\
P_{3}=D_{2} \oplus D_{3} \oplus D_{4}=1 \oplus 0 \oplus 1=0
\end{array}
$$

- 所以, 信息序列1010 对应的海明码为 $101 \underline{0} 0 \underline{10}$
  - 注意,异或运算有结合律

- (下画线为校验位, 其他为信息位)

## 海明码的校验(使用)

### 判断对错

- 利用各组内的奇偶校验(也是求**亦或XOR**的过程)来检查
- 将构成K个方程
  - Hamming Code=101`0`0`10`

$$
每个校验组分别利用校验位和参与形成该校验位的信息位进行奇偶校验检查, 构成  k  个校验 方程:
\\
\begin{array}{l}
S_{1}=P_{1} \oplus D_{1} \oplus D_{2} \oplus D_{4} \\
S_{2}=P_{2} \oplus D_{1} \oplus D_{3} \oplus D_{4} \\
S_{3}=P_{3} \oplus D_{2} \oplus D_{3} \oplus D_{4}
\end{array}
\\
$$

- 若$S_{3} S_{2} S_{1}$ 的值为 “ 000 ”, 则说明无错; 
- 否则说明出错, 且这个数就是错误位的位号, 
  - 如 $S_{3} S_{2} S_{1}=001$ , 说明第 1 位出错, 即  $H_{1}$  出错, 

### 纠错

- 纠错:直接将出错的位取反就达到了纠错的目的



