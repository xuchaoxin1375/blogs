[toc]



# è®¡ç®—æœºç½‘ç»œçš„ç»„æˆ

## ç»„æˆéƒ¨åˆ†è§’åº¦

- ç¡¬ä»¶
  - ä¸»æœº(ç«¯ç³»ç»Ÿ)
  - é€šä¿¡é“¾è·¯(å…‰çº¤/åŒç»çº¿)
  - äº¤æ¢è®¾å¤‡(è·¯ç”±å™¨,äº¤æ¢æœº)
- è½¯ä»¶
  - å®ç°èµ„æºå…±äº«çš„è½¯ä»¶
  - æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨çš„å„ç§å·¥å…·è½¯ä»¶
    - ç½‘ç»œæ“ä½œç³»ç»Ÿ
    - é‚®ä»¶æ”¶å‘ç¨‹åº
    - FTPç¨‹åº
    - èŠå¤©ç¨‹åº
    - ...
- åè®®
  - è®¡ç®—æœºç½‘ç»œçš„æ ¸å¿ƒéƒ¨åˆ†
  - è§„å®šäº†ç½‘ç»œä¼ è¾“æ—¶éµå¾ªçš„è§„èŒƒ

## å·¥ä½œæ–¹å¼è§’åº¦

- è¾¹ç¼˜éƒ¨åˆ†
  - æ‰€æœ‰è¿æ¥åˆ°Internetä¸Š,ä¾›ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„ä¸»æœºç»„æˆ
    - ç”¨æ¥è¿›è¡Œé€šä¿¡å’Œèµ„æºå…±äº«
- æ ¸å¿ƒéƒ¨åˆ†
  - å¤§é‡çš„ç½‘ç»œå’Œé“¾æ¥è¿™äº›ç½‘ç»œçš„è·¯ç”±å™¨ç»„æˆ

## åŠŸèƒ½ç»„æˆ

- é€šä¿¡å­ç½‘
  - åŒ…æ‹¬
    - å„ç§ä¼ è¾“**ä»‹è´¨**
    - **é€šä¿¡è®¾å¤‡**
    - ç›¸åº”çš„ç½‘ç»œ**åè®®**ç»„æˆ
  - ä½¿å¾—ç½‘ç»œå…·æœ‰
    - æ•°æ®ä¼ è¾“
    - äº¤æ¢
    - æ§åˆ¶
    - å­˜å‚¨çš„èƒ½åŠ›
    - å®ç°è”ç½‘è®¡ç®—æœºä¹‹é—´çš„æ•°æ®é€šä¿¡
- èµ„æºå­ç½‘
  - å®ç°**èµ„æºå…±äº«**çš„**è®¾å¤‡åŠå…¶è½¯ä»¶**çš„é›†åˆ
    - å‘ç½‘ç»œç”¨æˆ·æä¾›å…¶ä»–è®¡ç®—æœºä¸Šçš„
      - ç¡¬ä»¶èµ„æº
      - è½¯ä»¶èµ„æº
      - æ•°æ®èµ„æº

#  è®¡ç®—æœºç½‘ç»œæ•°æ®å•å…ƒåŸºæœ¬è”ç³»

## åŸºæœ¬æ¦‚å¿µ

### å®ä½“

- ä»»ä½•å¯ä»¥**å‘é€æˆ–æ¥å—ä¿¡æ¯çš„**
  - ç¡¬ä»¶
  - è½¯ä»¶è¿›ç¨‹
  - é€šå¸¸æ˜¯ä¸€ä¸ªè½¯ä»¶æ¨¡å—

### å¯¹ç­‰å±‚

- ä¸åŒ**æœºå™¨**ä¸Šçš„åŒä¸€å±‚ç§°ä¸ºå¯¹ç­‰å±‚

### å¯¹ç­‰å®ä½“

- åŒä¸€å±‚çš„ä¸åŒå®ä½“ç§°ä¸ºå¯¹ç­‰å®ä½“

- ç¬¬nå±‚(ä¸‹å±‚)å®ä½“å®ç°çš„æœåŠ¡ä¸ºç¬¬n+1å±‚(ä¸Šå±‚)æä¾›æœåŠ¡

## åè®®@æ¥å£@æœåŠ¡

- ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/830c8c2ece0e46d4854df304a1f2c95b.png)

### åè®®

- è§„åˆ™çš„é›†åˆ
  - å…·æœ‰çº¿è·¯ç®¡ç†
  - å·®é”™æ§åˆ¶
  - æ•°æ®è½¬æ¢ç­‰åŠŸèƒ½
- ç”±3éƒ¨åˆ†ç»„æˆ
  - è¯­æ³•
    - è§„å®šä¼ è¾“æ ¼å¼
  - è¯­ä¹‰
    - å®šä¹‰åŠŸèƒ½
      - æ§åˆ¶ä¿¡æ¯
      - åŠ¨ä½œ
      - åº”ç­”
  - åŒæ­¥
    - äº‹ä»¶æ‰§è¡Œé¡ºåºçš„è¯¦ç»†è¯´æ˜
    - è§„å®šæ‰§è¡ŒåŠ¨ä½œçš„æ¡ä»¶å’Œæ—¶åº

### æ¥å£

- ç›¸é‚»å±‚é—´æ¥å£
  - ç³»ç»Ÿå±‚æ¬¡çš„ä¸Šä¸‹å±‚ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ¥å£
  - æœ¬å±‚(ç¬¬Nå±‚)çš„SAPæ˜¯å…¶ä¸Šå±‚(ç¬¬N+1å±‚)å¯ä»¥è®¿é—®æœ¬å±‚(ç¬¬Nå±‚)(æä¾›çš„)æœåŠ¡çš„åœ°æ–¹

- åŒä¸€ç»“ç‚¹å†…,ç›¸é‚»ä¸¤å±‚é—´äº¤æ¢ä¿¡æ¯çš„è¿æ¥ç‚¹
- æ¯å±‚åªèƒ½ä¸ºç´§é‚»çš„å±‚æ¬¡ä¹‹é—´å®šä¹‰æ¥å£,ä¸èƒ½è·¨å±‚å®šä¹‰æ¥å£
- åŒä¸€ç»“ç‚¹ç›¸é‚»å±‚çš„å®ä½“é€šè¿‡SAP(service access point)è¿›è¡Œäº¤äº’
  - SAP,not SPA

- æœåŠ¡æ˜¯é€šè¿‡SAPæä¾›ç»™ä¸Šå±‚ä½¿ç”¨çš„

#### æœåŠ¡è®¿é—®ç‚¹SAP



- | åˆ†å±‚       | SAP(å‘ç›¸é‚»ä¸Šå±‚æä¾›çš„æœåŠ¡è®¿é—®ç‚¹) |
  | ---------- | ------------------------------- |
  | åº”ç”¨å±‚     | ç”¨æˆ·ç•Œé¢                        |
  | ä¼ è¾“å±‚     | ç«¯å£å·                          |
  | ç½‘ç»œå±‚     | IPåœ°å€                          |
  | æ•°æ®é“¾è·¯å±‚ | ç½‘å¡åœ°å€                        |
  | ç‰©ç†å±‚     | ç½‘å¡æ¥å£                        |

  - ä¾‹å¦‚:
    - ç”¨æˆ·é€šè¿‡**åº”ç”¨å±‚çš„SAP:ç”¨æˆ·ç•Œé¢**ä½¿ç”¨åº”ç”¨å±‚çš„æœåŠ¡
    - åº”ç”¨å±‚ä½¿ç”¨ä¼ è¾“å±‚çš„SAP:ç«¯å£å·,æ¥ä½¿ç”¨ä¼ è¾“å±‚æä¾›çš„æœåŠ¡
    - ...
    - æ•°æ®é“¾è·¯å±‚é€šè¿‡ä½¿ç”¨ç‰©ç†çš„SAP:ç½‘å¡æ¥å£,æ¥è°ƒç”¨ç‰©ç†å±‚çš„æœåŠ¡

### æœåŠ¡

- ä¸‹å±‚ä¸ºç´§é‚»çš„ä¸Šå±‚æä¾›åŠŸèƒ½è°ƒç”¨(å‚ç›´)

#### æœåŠ¡åŸè¯­

- æœåŠ¡åŸè¯­MAP(Service Primitive; primitives; MAP)
  - è¯·æ±‚(Request)
  - æŒ‡ç¤º(Indication)
  - å“åº”(Response)
  - è¯å®(Confirmation)
- å¯¹äº**æœ‰åº”ç­”æœåŠ¡**,åŒ…æ‹¬å…¨éƒ¨4ç±»åŸè¯­
- æ— åº”ç­”é‚£æœåŠ¡,åªæœ‰**è¯·æ±‚å’ŒæŒ‡ç¤º**ä¸¤ç±»åŸè¯­
  - å“åº”å’Œè¯å®éƒ½æ˜¯åº”ç­”æœåŠ¡çš„èŒƒç•´



## æŠ¥æ–‡(åè®®æ•°æ®å•å…ƒPDU)ğŸˆ

- ä½“ç³»ç»“æ„çš„å„å±‚çš„æŠ¥æ–‡(PDU)éƒ½åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†
  - æ•°æ®éƒ¨åˆ†SDU
  - æ§åˆ¶ä¿¡æ¯éƒ¨åˆ†PCI

### SDU

- æœåŠ¡æ•°æ®å•å…ƒSDU([Service data unit](https://en.wikipedia.org/wiki/Service_data_unit):)ä¸ºå®Œæˆç”¨æˆ·è¦æ±‚çš„åŠŸèƒ½è€Œä¼ é€çš„æ•°æ®,å¯ä»¥å…·ä½“åœ°æŠŠç¬¬nå±‚çš„SDUè®°ä¸º:$n-SDU$

### PCI

- åè®®æ§åˆ¶ä¿¡æ¯:æ§åˆ¶åè®®æ“ä½œçš„ä¿¡æ¯,å¯ä»¥å…·ä½“åœ°æŠŠç¬¬nå±‚çš„PCIè®°ä¸º:$n-PCI$

### PDU

- å¯¹ç­‰å±‚ä¹‹é—´ä¼ é€çš„æ•°æ®å•ä½,ç§°ä¸ºè¯¥å±‚çš„PDU([Protocol data unit  ](https://en.wikipedia.org/wiki/Protocol_data_unit)),å…·ä½“æŠŠç¬¬nå±‚çš„PDUè®°ä¸º:$n-PDU$
- ä¸ºäº†ä¹¦å†™ç»“æ„æ¸…æ™°,å°†ä¸åŒå±‚çš„PDUç”¨å‰ç¼€`LayerName@`è¡¨ç¤º
  - ä¾‹å¦‚:`ç‰©ç†å±‚@PDU`è¡¨ç¤ºç‰©ç†å±‚çš„æœåŠ¡æ•°æ®å•å…ƒ
- æ¯å±‚çš„åè®®æ•°æ®å•å…ƒéƒ½æœ‰é€šä¿—çš„åç§°:
  - ä¼ è¾“å±‚@PDUç§°ä¸º**æŠ¥æ–‡æ®µ**
    - å¯¹äºTCP/IPæ¨¡å‹è€Œè¨€
      - é‡‡ç”¨TCPåè®®æ—¶PDUç§°ä¸º**æ®µ**(segment)
      - é‡‡ç”¨UDPåè®®æ—¶PDUç§°ä¸º**æŠ¥æ–‡**(datagram)
  - ç½‘ç»œå±‚@PDUç§°ä¸º**åˆ†ç»„/åŒ…**(packet)
    - å¯¹äºTCP/IPæ¨¡å‹ä¸­ç½‘é™…å±‚ä½¿ç”¨çš„IPåè®®,å…¶åè®®æ•°æ®å•å…ƒPDUå¯ä»¥ç§°ä¸ºIP Datagram(IPæ•°æ®æŠ¥)
      - å’Œä¼ è¾“å±‚UDPåè®®çš„datagramä¸ä¸€æ ·
    - packet:**ç½‘ç»œ**é‡Šä¹‰:
      - å°åŒ…ï¼›åˆ†ç»„ï¼›å°åŒ…
  - ç‰©ç†å±‚@PDUç§°ä¸º**æ¯”ç‰¹(bit)**
  - æ•°æ®é“¾è·¯å±‚@PDUç§°ä¸º**å¸§**

#### OSI model PDU

Protocol data units of the [OSI model](https://en.wikipedia.org/wiki/OSI_model) are:[[1\]](https://en.wikipedia.org/wiki/Protocol_data_unit#cite_note-1)

- The Layer 4: [transport layer](https://en.wikipedia.org/wiki/Transport_layer) PDU is the [segment](https://en.wikipedia.org/wiki/Packet_segment) or the **datagram**.(æ®µ/æŠ¥æ–‡,ç»Ÿç§°**æŠ¥æ–‡æ®µ**)
- The Layer 3: [network layer](https://en.wikipedia.org/wiki/Network_layer) PDU is the [packet](https://en.wikipedia.org/wiki/Network_packet).(åˆ†ç»„(åŒ…))
- The Layer 2: [data link layer](https://en.wikipedia.org/wiki/Data_link_layer) PDU is the [frame](https://en.wikipedia.org/wiki/Frame_(networking)).(å¸§)
- The Layer 1: [physical layer](https://en.wikipedia.org/wiki/Physical_layer) PDU is the [bit](https://en.wikipedia.org/wiki/Bit) or, more generally, [symbol](https://en.wikipedia.org/wiki/Symbol_(data)).(æ¯”ç‰¹)

- Given a context pertaining to a specific OSI layer, *PDU* is sometimes used as a synonym for its representation at that layer.

![image-20220527233403145](https://img-blog.csdnimg.cn/img_convert/fced57cd1ca6fbd305183edf91e9d4c0.png)

#### Internet protocol suite PDU

Protocol data units for the [Internet protocol suite](https://en.wikipedia.org/wiki/Internet_protocol_suite) are:

- The [transport layer](https://en.wikipedia.org/wiki/Transport_layer) PDU is
  -  the [TCP segment](https://en.wikipedia.org/wiki/TCP_segment) for **TCP** ,
  -  the **datagram** for **UDP**
- The [Internet layer](https://en.wikipedia.org/wiki/Internet_layer) PDU is the [packet](https://en.wikipedia.org/wiki/Network_packet).
- The [link layer](https://en.wikipedia.org/wiki/Link_layer) PDU is the [frame](https://en.wikipedia.org/wiki/Frame_(networking)).

- On TCP/IP over Ethernet, the data on the physical layer is carried in [Ethernet frames](https://en.wikipedia.org/wiki/Ethernet_frame).

#### å…³ç³»ğŸˆ

- $SDU+PCI=PDU$
  - ä¸ºäº†ä¹¦å†™ç»“æ„æ¸…æ™°,å°†ä¸Šè¿°çš„`n-`å‰ç¼€ç”¨`n@`è¡¨ç¤º
    - $n@SDU+n@PCI=n@PDU$
    - å¦å¤–,ç”±å±‚é—´å…³ç³»,å¯ä»¥çŸ¥é“
      - $n@PDU=(n-1)@SDU$
        - ä¹Ÿå°±æ˜¯è¯´,ä¸Šä¸€å±‚(n)çš„PDUä¼ ç»™ä¸‹ä¸€å±‚(n-1)ä½œä¸ºæœåŠ¡æ•°æ®å•å…ƒè¿›è¡Œæ‰“åŒ…
        - ç›¸é‚»å±‚é—´çš„PDUå’ŒSDUçš„é€’æ¨å…³ç³»

 

### review

#### ä¼ è¾“å±‚@ç½‘ç»œå±‚

- **Segment**
  - A segment is the unit of end-to-end transmission in the  **TCP protocol**. 
  - A segment consists of a TCP header followed  by application data.
  -  A segment is transmitted by  encapsulation inside an **IP datagram**.

- **IP Datagram**
  - å’Œä¼ è¾“å±‚çš„UDPåè®®çš„æŠ¥æ–‡(Datagram)æœ‰æ‰€ä¸åŒ
  - IPåè®®æ˜¯ç½‘ç»œå±‚(ç½‘é™…å±‚)çš„,è€Œä¸”æ˜¯ä¸“é—¨æŒ‡çš„TCP/IP4å±‚æ¨¡å‹
  - An IP datagram is **the unit** of end-to-end transmission in  the **IP protocol**.
  -  An IP datagram consists of an IP header  followed by transport layer data, i.e., of an IP header  followed by a message.
  - In the description of the internet layer  , the  unqualified term "datagram" should be understood to refer  to an IP datagram.

#### ç½‘ç»œå±‚@æ•°æ®é“¾è·¯å±‚

- **Packet**
  - A packet is the unit of data passed across the **interface**  between **the internet layer** and **the link layer**.
  -  It  includes an IP header and data.
  -  A packet may be `a  complete IP datagram` or `a fragment of an IP datagram`.

#### æ•°æ®é“¾è·¯å±‚@ç‰©ç†å±‚

- **Frame**
  - A frame is the unit of transmission in a link layer  protocol, and consists of a link-layer header followed by
    a packet.


## IPæ•°æ®æŠ¥
- æŠ¥æ–‡å¤´éƒ¨çš„ç»“æ„æ˜¯ä½“ç°IPåˆ†ç»„çš„æ ¸å¿ƒ

- å…¶ä¸­,å›ºå®šéƒ¨åˆ†åˆæ˜¯æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ(å…±å æœ‰20B)(80bit)
- ä¸‹è¡¨ä¸­,ç¬¬ä¸€è¡Œ(å³åˆ†ç»„å¤´éƒ¨çš„å‰4Byte)åŒ…å«çš„å†…å®¹è¯¥åˆ†ç»„çš„æœ€åŸºæœ¬ä¿¡æ¯
- ç¬¬äºŒè¡Œå†…å®¹æœ‰ä¸‰ä¸ªå­—æ®µ,ä½“ç°ç½‘ç»œå±‚çš„åˆ†ç»„å’Œè¯¥åˆ†ç»„å¯èƒ½åœ¨æ•°æ®é“¾è·¯å±‚è¢«åˆ†ç‰‡æœ‰å…³
- ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/c7fb82111e5242b09bbe0ce34b76d181.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_16,color_FFFFFF,t_70,g_se,x_16)
- æ›´ç»†çš„åˆ’åˆ†

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/1edf7daf01ec4454b261f4eb9020fb3a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_14,color_FFFFFF,t_70,g_se,x_16)


- 1)ç‰ˆæœ¬ã€‚æŒ‡Pçš„ç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„ç‰ˆæœ¬å·ä¸º4
- 2)é¦–éƒ¨é•¿åº¦ã€‚
  - å 4ä½ï¼Œå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°æ˜¯15ã€‚
  - ä»¥32ä½ä¸ºå•ä½ï¼Œæœ€å¤§å€¼ä¸º60B(15Ã—4B)ã€‚
  - æœ€å¸¸ç”¨çš„é¦–éƒ¨é•¿åº¦æ˜¯20B,æ­¤æ—¶ä¸ä½¿ç”¨ä»»ä½•é€‰é¡¹ï¼ˆå³å¯é€‰å­—æ®µï¼‰ã€‚
- 3)æ€»é•¿åº¦ã€‚
  - å 16ä½ã€‚æŒ‡é¦–éƒ¨å’Œæ•°æ®ä¹‹å’Œçš„é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œå› æ­¤æ•°æ®æŠ¥çš„æœ€å¤§é•¿åº¦ä¸º216-1=65535Bã€‚
  - ä»¥å¤ªç½‘å¸§çš„æœ€å¤§ä¼ é€å•å…ƒ(MTU)ä¸º1500B,å› æ­¤å½“ä¸€ä¸ªPæ•°æ®æŠ¥å°è£…æˆå¸§æ—¶ï¼Œæ•°æ®æŠ¥çš„æ€»é•¿åº¦ï¼ˆé¦–éƒ¨åŠ æ•°æ®ï¼‰ä¸€å®šä¸èƒ½è¶…è¿‡ä¸‹é¢çš„æ•°æ®é“¾è·¯å±‚çš„MTUå€¼ã€‚
- 4)æ ‡è¯†ã€‚
  - å 16ä½ã€‚
  - å®ƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯äº§ç”Ÿä¸€ä¸ªæ•°æ®æŠ¥å°±åŠ 1ï¼Œå¹¶èµ‹å€¼ç»™æ ‡è¯†å­—æ®µã€‚
  - ä½†å®ƒå¹¶ä¸æ˜¯â€œåºå·â€(å› ä¸ºPæ˜¯æ— è¿æ¥æœåŠ¡)ã€‚
  - å½“ä¸€ä¸ªæ•°æ®æŠ¥çš„é•¿åº¦è¶…è¿‡ç½‘ç»œçš„MTUæ—¶ï¼Œå¿…é¡»åˆ†ç‰‡ï¼Œæ­¤æ—¶æ¯ä¸ªæ•°æ®æŠ¥ç‰‡éƒ½å¤åˆ¶ä¸€æ¬¡æ ‡è¯†å·ï¼Œä»¥ä¾¿èƒ½æ­£ç¡®é‡è£…æˆåŸæ¥çš„æ•°æ®æŠ¥ã€‚
- 5)æ ‡å¿—ã€‚
  - å 3ä½ã€‚
  - æ ‡å¿—å­—æ®µçš„æœ€ä½ä½ä¸ºMF,
    - MF=1è¡¨ç¤ºåé¢è¿˜æœ‰åˆ†ç‰‡ï¼ŒMF=0è¡¨ç¤ºæœ€åä¸€ä¸ªåˆ†ç‰‡ã€‚
    - æ ‡å¿—å­—æ®µä¸­é—´çš„ä¸€ä½æ˜¯DF,åªæœ‰å½“DF=0æ—¶æ‰å…è®¸åˆ†ç‰‡ã€‚
- 6)ç‰‡åç§»ã€‚
  - å 13ä½ã€‚
  - å®ƒæŒ‡å‡ºè¾ƒé•¿çš„åˆ†ç»„åœ¨åˆ†ç‰‡åï¼ŒæŸç‰‡åœ¨åŸåˆ†ç»„ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚
  - ç‰‡åç§»ä»¥8ä¸ªå­—èŠ‚ä¸ºåç§»å•ä½ï¼Œå³æ¯ä¸ªåˆ†ç‰‡çš„é•¿åº¦ä¸€å®šæ˜¯8B(64ä½)çš„æ•´æ•°å€ã€‚
- ç”Ÿå­˜æ—¶é—´(TTL)(time to live)
  - å 8ä½ã€‚
  - æ•°æ®æŠ¥åœ¨ç½‘ç»œä¸­å¯é€šè¿‡çš„è·¯ç”±å™¨æ•°çš„æœ€å¤§å€¼ï¼Œæ ‡è¯†åˆ†ç»„åœ¨ç½‘ç»œä¸­çš„å¯¿å‘½ï¼Œä»¥ç¡®ä¿åˆ†ç»„ä¸ä¼šæ°¸è¿œåœ¨ç½‘ç»œä¸­å¾ªç¯ã€‚
  - è·¯ç”±å™¨åœ¨è½¬å‘åˆ†ç»„å‰ï¼Œå…ˆæŠŠTTLå‡1.è‹¥TTLè¢«å‡ä¸º0ï¼Œåˆ™è¯¥åˆ†ç»„å¿…é¡»ä¸¢å¼ƒã€‚
- 8)åè®®ã€‚
  - å 8ä½ã€‚
  - æŒ‡å‡ºæ­¤åˆ†ç»„æºå¸¦çš„æ•°æ®ä½¿ç”¨ä½•ç§åè®®ï¼Œå³åˆ†ç»„çš„æ•°æ®éƒ¨åˆ†åº”äº¤ç»™å“ªä¸ªä¼ è¾“å±‚åè®®ï¼Œå¦‚TCPã€UDPç­‰ã€‚
  - å…¶ä¸­å€¼ä¸º6è¡¨ç¤ºTCP,å€¼ä¸º17è¡¨ç¤ºUDP.
- 9)é¦–éƒ¨æ ¡éªŒå’Œã€‚
  - å 16ä½ã€‚
  - Pæ•°æ®æŠ¥çš„é¦–éƒ¨æ ¡éªŒå’Œåªæ ¡éªŒåˆ†ç»„çš„é¦–éƒ¨ï¼Œè€Œä¸æ ¡éªŒæ•°æ®éƒ¨åˆ†ã€‚
- 10)æºåœ°å€å­—æ®µã€‚
  - å 4B,æ ‡è¯†å‘é€æ–¹çš„Påœ°å€ã€‚
- 11)ç›®çš„åœ°å€å­—æ®µã€‚
  - å 4B,æ ‡è¯†æ¥æ”¶æ–¹çš„Påœ°å€ 

## ç”¨æˆ·æ•°æ®åœ¨å„å±‚çš„å°è£…

- 4æ¬¡å¤´éƒ¨å°è£…

- æ€»çš„æ¥è¯´,æ•°æ®å¾€è¶Šåº•å±‚èµ°,éœ€è¦å°è£…çš„å†…å®¹å°±è¶Šå¤š(å¤„ç†çš„å·¥åºè¶Šå¤š)

- åº”ç”¨ç¨‹åºæ·»åŠ çš„å¤´éƒ¨
- TCPå¤´éƒ¨(ä¼ è¾“å±‚å¤´éƒ¨)
- IPå¤´éƒ¨(ç½‘ç»œå±‚å¤´éƒ¨)
- Ethernetå¤´éƒ¨å’Œå°¾éƒ¨(å°è£…æˆå¸§)
	- å¦‚æœæ•°æ®é“¾è·¯å±‚å±€åŸŸç½‘é‡‡ç”¨ä»¥å¤ªç½‘æŠ€æœ¯,é‚£ä¹ˆIPåˆ†ç»„çš„å¤§å°ä¸è¶…è¿‡1500Byte(ä¸è¶³46Bytesæ—¶,éœ€è¦æ•°æ®é“¾è·¯å±‚åšå¡«å……å¤„ç†)
	- å¦‚æœæ•°æ®é“¾è·¯å±‚é‡‡ç”¨çš„ä¸æ˜¯Ethernet,é‚£ä¹ˆå¯¹IPåˆ†ç»„çš„å¤§å°æœ‰å…¶ä»–è¦æ±‚
	- EtherNet å’Œå„å±‚æ•°æ®æŠ¥ä¹‹é—´çš„å¤§è‡´å…³ç³»:
		-  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/2bb05d30664140e294cf7251877c25b4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_20,color_FFFFFF,t_70,g_se,x_16)

# IPæ•°æ®æŠ¥/ä»¥å¤ªç½‘Macå¸§ä¹‹é—´çš„å…³ç³»

## IPæ•°æ®æŠ¥åˆ†ç‰‡

- **åŸå§‹æ•°æ®æŠ¥é¦–éƒ¨**è¢«å¤åˆ¶ä¸ºå„**æ•°æ®æŠ¥ç‰‡çš„é¦–éƒ¨**ï¼Œä½†å¿…é¡»ä¿®æ”¹æœ‰å…³å­—æ®µçš„å€¼ã€‚
- ä¾‹å¦‚:
	- ä¸€æ•°æ®æŠ¥çš„æ€»é•¿åº¦ä¸º 3820 å­—èŠ‚ï¼Œå…¶`æ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¸º 3800 å­—èŠ‚`ï¼ˆä½¿
	ç”¨å›ºå®šé¦–éƒ¨ï¼‰ï¼Œéœ€è¦`åˆ†ç‰‡ä¸ºé•¿åº¦ä¸è¶…è¿‡ 1420 å­—èŠ‚`çš„æ•°æ®æŠ¥ç‰‡ã€‚
	ï¬ å› å›ºå®šé¦–éƒ¨é•¿åº¦ä¸º 20 å­—èŠ‚ï¼Œå› æ­¤`æ¯ä¸ªæ•°æ®æŠ¥ç‰‡çš„æ•°æ®éƒ¨åˆ†é•¿åº¦`ä¸èƒ½è¶…
	è¿‡ 1400 å­—èŠ‚ã€‚
	ï¬ äºæ˜¯åˆ†ä¸º 3 ä¸ªæ•°æ®æŠ¥ç‰‡ï¼Œå…¶æ•°æ®éƒ¨åˆ†çš„é•¿åº¦åˆ†åˆ«ä¸º 1400ã€1400 å’Œ
	1000 å­—èŠ‚ã€‚
	![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/cf6979d23ed840448183adb09a46cf20.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_18,color_FFFFFF,t_70,g_se,x_16)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/6481a68231624842af92f9a0fcc94c67.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_20,color_FFFFFF,t_70,g_se,x_16)

###  wireshark åˆ†æIP æ•°æ®æŠ¥é¦–éƒ¨

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/fa6f20b695714572a1bdd514bf67d41f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAeHVjaGFveGluMTM3NQ==,size_18,color_FFFFFF,t_70,g_se,x_16)
- `Identivication`==æ ‡è¯†==å äº†16ä½(ä»ä¸Šé¢çš„æŠ“åŒ…çš„å–å€¼0x739c(å…­è¿›åˆ¶æ•°,è€Œä¸”æ˜¯4ä½16è¿›åˆ¶æ•°,æ¯ä¸ªåå…­è¿›åˆ¶æ•°ç›¸å½“äº4ä½äºŒè¿›åˆ¶æ•°,æ‰€ä»¥æ ‡è¯†å­—æ®µå 2Byte:16bit
- `Flags`==æ ‡å¿—==
	- æ ‡å¿—å­—æ®µå ä¸‰ä½
	- ç°åœ¨,ä»…æœ‰åé¢ä¸¤ä½æœ‰ç”¨å¤„,ç¬¬ä¸€ä½æš‚æ—¶ä¿ç•™ä¸ç”¨
	- DF=1æ—¶,è¡¨ç¤ºæ•°æ®æŠ¥ä¸å¯åˆ†ç‰‡(å¦åˆ™å¯)
	- MF=1æ—¶,è¡¨ç¤ºè¯¥IPåˆ†ç»„æ˜¯æŸä¸ªIPæ•°æ®æŠ¥çš„æŸä¸ªåˆ†ç‰‡,ä¸”ä¸æ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡(å¦åˆ™å°±æ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡)
	- ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/9234a5abec7f40babbfcb6b09b6fe03a.png)
- åç§»ä½å 13ä½
- å¤´éƒ¨çš„ç¬¬2è¡Œ(4~7)å­—èŠ‚ä¸­,ç¬¬4å­—èŠ‚çš„å€¼æ˜¯`0100 0000`,å…¶åå…­è¿›åˆ¶è¡¨ç¤ºä¸º`0x40`





