# os_读者-写者问题

> 读者&写者问题是一个经典的同步互斥问题



- 一个数据文件或记录可被多个进程共享，我们把
  - 只要求读该文件的进程称为“Reader进程”，
  - 其他进程则称为“Writer进程”。
  - 允许多个进程同时读一个共享对象，因为读操作不会使数据文件混乱。
  - 但不允许一个Writer进程和其他Reader进程或Writer进程同时访问共享对象。因为这种访问将会引起混乱。
- 所谓“读者-写者(Reader-Writer Problem)问题”是指**保证一个 Writer进程必须与其他进程互斥地访问共享对象的同步问题**。读者-写者问题常被用来测试新同步原语。

## 1．利用记录型信号量解决读者-写者问题

- 为实现Reader与 Writer进程间**在读或写时的互斥**而设置了一个互斥信号量**Wmutex.**
- 另外，再设置一个**整型变量Readcount表示正在读的进程数目**。
- 由于**只要有一个Reader进程在读**，便不允许Writer进程去写。
  - 因此，(仅当Readcount=O，表示**尚无 Reader进程在读**时，Reader进程**才需要**<u>执行Wait(Wmutex)操作</u>。
    - 在这种条件下,多个读者进程可以不会互斥的读取临界资源
    - 如果每个资源都一律加Wmutex锁,将导致**多余的**读者间**互斥**地读取临界资源文件(而为了避免这样的问题,应该通过判断count的值,来决定当前的读者进程需不需要加Wmutex锁)
- 若wait(Wmutex)操作成功，Reader进程便可去读，相应地，**做 Readcount+1操作**。
  - 同理，仅当Reader进程在**执行了Readcount 减1操作后其值为О时**，(**才需要执行signal(Wmutex)操作**，(以便让 Writer进程写操作。
    - 释放锁的操作仅让最后一个读者来执行((--count==0)的那个读者)
      - 如果还有其他读者在读文件,就急于释放锁,可能会导致写者抢占Wmutex,导致读/写者互斥失效
    - 在这种条件下,所有读者进程都已经结束对临界资源的读取,可以将使用临界资源的权利释放给**写进程**
- 又因为**Readcount**是一个**可被多个Reader进程访问的临界资源**，因此，也应该**为它设置一个互斥信号量rmutex** 。