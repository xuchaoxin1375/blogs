[toc]

## 主存芯片和cpu的连接原理

- 主存通过数据线/地址线/控制线和cpu相连
  - 数据总线的位数$W_D$和总线工作频率$f_B$的乘积$B=W_Df_B$正比于数据传输速率
  - 地址总线的位数决定了**可寻址的最大内存空间**
  - 控制总线(读.写)指出总线周期的类型和本次输入输出操作完成的时刻

- 多个内存芯片集成到一个内存条上
- 多个<u>内存条</u>和<u>主板上的ROM芯片</u>组成计算机所需的<u>主存空间</u>,再通过总线与cpu相连
  - **内存条插槽**就是存储器总线
  - 内存中的信息通过**内存条的引脚**,再通过**插槽内的引线**连接到主板上
  - **主板上的导线**连接到cpu上

## 主存容量的扩展

- 单个芯片的容量有限
- 可通过字扩展/位扩展两方面来扩充主存容量
  - 位扩展法
  - 字扩展发
  - 字位同时扩展

- 存储器容量S=地址线数$N_A$乘以字长W
  - $S=N_A\times{W}$

### 位扩展法

- cpu的数据线和存储芯片数据位数不一定相等
- 必须进行位扩展,使用多个存储器间对字长进行扩展,使其**数据位数**和cpu的数据线相等
  - 也即是扩展**单个存储字的字长**(仅提升W)
    - 可见,单纯的位扩展没有扩大寻址范围
    - 在同一时刻,cpu片选中所有芯片,每个芯片读取相同个bit内容
    - 片选信号$\overline{CS}$要链接到所有芯片
    - 每片的数据线一次作为cpu数据线的一位
    - 采用位扩展时,所有芯片链接地址线的方式相同
  - 另一种扩展方式是字扩展法,扩展的是**存储字总数**(仅提升$N_A$)
- 将多个存储芯片的以下方面相应并联
  - 地址端
  - 片选端
  - 读写控制端

- 数据端分别引出

### 字扩展法

- 扩展的是**存储字总数**(仅提升$N_A$),字的位数不变
- 将芯片的以下方面相应并联
  - 地址线
  - 数据线
  - 读写控制线
- <u>片选信号用来区分各芯片的地址范围</u>
- 仅采用字扩展时,各芯片
  - 连接地址线的方式相同
  - 连接数据线的方式**也相同**
  - 但是在某一时刻只选中部分芯片
  - 通过**片选信号$\overline{CS}$**或者采用译码器设计连接到相应存储芯片

### 字位同时扩展法

- 同时增加$N_A,W$
- 一般先执行位扩展(分组$\to$整体)
- 再执行字扩展
- 连线:
  - 所有芯片的地址线连线还是相同
  - 数据线不同

## 存储芯片的地址分配和片选

- cpu访问存储单元
  - 首先需要进行**片选**
    - 多个存储芯片构成的存储器,选择其中的一片进行访问
    - 片选信号的产生分为**线选法**和**译码片选法**
  - 再进行**字选**
    - 在选中的芯片中,根据**地址码**选择相应的存储单元
    - 片内的字选通常由cpu送出的N条**低位地址线**完成的
    - 地址线直接链接到所有存储芯片的**地址输入端**

### 线选法

- 不需要译码器,线路简单
- 地址空间不连续,片选的地址线必须分时为低电平(否则不能工作)
- 可能无法充分利用系统的存储器空间,造成地址资源浪费
  - 比如cpu可用的高位地址线数量不足以选中大量需要独立选中的芯片(组),即片选信号种类不足

### 译码片选法

- 用高位地址线(除了**片内寻址**外的)通过地址译码器芯片产生片选信号

### 例🎈

- 若芯片地址为111时,选定某一个$32K\times{16}$bit的存储芯片工作,则该芯片在存储器中的首地址和末地址分别为?
  - 分析高地址和低地址
  - 高地址:
    - 片选地址(选中的芯片地址)作为高地址是111
  - 低地址:
    - 属于片内地址范畴
    - 片内部分的起始地址为全0
    - 片内的末地址为全1
    - 又已知每个芯片的地址线为$\log_2{32K}=15$
    - 所以低地址/高地址分别为15个0和15个1
    - 再拼接高地址3位111
    - 得到$111\ \underbrace{0\cdots{00}}_{15\times{'0'}}$和$111\ \underbrace{1\cdots{11}}_{15\times{'1'}}$
    - 转化为16进制(从低位到高位,每4位一组;18位看做高2位和16位低位(4*4=16))后,分别对应
      - 38000H;3FFFFH

### 例

- 地址总线$A_0(高位)\sim{A_{15}(低位)}$

  - 用$4k\times{4}bit$的存储芯片组成16KB的存储器

    - $m=\frac{16kB}{4k\times{4bit}}=8$

    - 16kB=$16k\times{8bit}$

      - 因此,先进行位扩展,每片芯片组成一组8bit的($4k\times{8}$)芯片

      - 再将4组芯片做字扩展,构成$16k\times{8bit}$存储器

      - 区分4组芯片需要占用$\log_2{4}=2$bit二进制为;

      - 使用译码器(2/4)译码器进行片选,片选信号的输入地址线数为2条

      - 值得注意的是,本题给出的高位是从$A_0$开始,低位是从$A_{15}$开始的

      - 链接单片芯片的地址线数需要$\log_2{4K}=12$

        - $从A_{15}到A_y$共12根线
          - $15-y=12-1\Rightarrow{y=4}$

        - 因此,连接高位地址线$A_3,A_2$作为接入译码器的输入信号线

### 例

- 若内存地址区间为$4000H\sim{43FFH}$每个存储单元可以存储16bit二进制数(按字(存储单元)编址)

- 该内存区域用4片存储芯片构成,构成该内存所用的存储器芯片容量是?

  - 首先根据区间计算出总容量:

  - $$
    地址区间[闭区间]宽度:
    \\W=(43FFH-4000H+1)
    =(4400H-4000H)=400H
    \\=4\times{16^2}=2^{2+8}=2^{10}
    \\总容量S=2^{10}\times{16bit}
    由4片芯片构成,每片芯片容量为:
    \\
    \frac{1}{4}S=2^8\times{16bit}
    \\或2^{10}\times{4}bit
    $$

    


### 例

- 如果低地址$A_0\sim{A_{16}}$连接在各个存储芯片的地址引脚上

- 高位($A_{12}\sim{A_{19}}$)进行片选译码(但是其中$A_{14}和A_{16}$不参于译码)

  - 也就是说,参与译码的高位线只有19-12+1-2=6条

  - 片选信号$\overline{CS}$低电平有效

  - 译码电路效果为:

    - $$
      \overline{CS}=\overline{A_{12}A_{13}A_{15}(A_{17}+A_{18})A_{19}}
      $$

      
      
      - 想要得到$\overline{CS}=0,必须使得A_{12,13,15,19}全部为1以及A_{17,18}中至少一个取1$
      - 换句话说参与译码的几条地址线中,只有最多只允许$A_{17,18}$中的一个可以为0,其余都为1
      
      

  - 如果某个地址区间的高位部分不满足$\overline{CS}=0$(低电平有效)

    - 那么这样的区间就不属于此译码空间

  - 例如

    - $A:AB000H\sim{ABFFFH}$
    - $B:BB000H\sim{BBFFFH}$
    - $C:EF000H\sim{EFFFFH}$
    - $D:FE000H\sim{FEFFFH}$


##### 以A选项为例

- 先分析地址的二进制形式的位数(地址转为转换2进制有两类思路)

- 最高位权法

  - 给出的地址都是5位十六进制数
  - 最高位上的权位是$16^{4}=2^{16}$
  - $AH=1010_2$
  - $AB000H$是一个4+16=20位的地址

- 分组转换法

  - 对于2的幂进制(8进制/16进制等,可以用更加简单的方法计算二进制的位数)

  - 即,每位十六进制对应4位二进制数(从低位到高位的方向转换)

  - 除了最高位单独转换(因为最高位未必满4bit);

  - 本题的情况只需要知道$A_{12}\sim{A_{19}}$($A_{14,16}$)两条除外,的几位即可,所有不用全部转换为二进制

  - $x=A\underbrace{B000}H$

    - 最高位外的所有位共4bit,$4\times{4}=16$

    - 最高位十六进制转2进制$A=1010_2$

    - 次高位B转为2进制:$B=1011_2$

    - 因此总共有4+16=20bit(最高位是第20bit)

    - 但是,要求最低位从0开始计数,最高位对应的地址线为$A_{19}$

    - | $A_{19}$ | $A_{18}$ | $A_{17}$ | $A_{16}$ | $A_{15}$ | $A_{14}$ | $A_{13}$ | $A_{12}$ |
      | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
      | 1        | 0        | 1        | 0        | 1        | 0        | 1        | 1        |
      

    - 由于$A_{16,14}$两条线不参与译码,因此被忽略掉

      - | $A_{19}$ | $A_{18}$ | $A_{17}$ | $A_{15}$ | $A_{13}$ | $A_{12}$ |
        | -------- | -------- | -------- | -------- | -------- | -------- |
        | 1        | 0        | 1        | 1        | 1        | 1        |

      - 带入到$\overline{CS}(101111)=0$(只有$A_{18}=0$)所以处于译码空间内

- 根据上面的分析,四个选项类似,只要看十六进制地址的前两位16进制数,将它们转换为2进制串
- 填写表格,既可以快速判断

##### 其他选型总结



- | 选项以及高2位16进制地址 | $A_{19}$ | $A_{18}$ | $A_{17}$ | $A_{16}$(pass) | $A_{15}$ | $A_{14}$(pass) | $A_{13}$ | $A_{12}$ | $\overline{CS}$ |
  | ----------------------- | -------- | -------- | -------- | -------------- | -------- | -------------- | -------- | -------- | --------------- |
  | A(ABH)                  | 1        | 0        | 1        | 0              | 1        | 0              | 1        | 1        | 0               |
  | B(BBH)                  | 1        | 0        | 1        | 1              | 1        | 0              | 1        | 1        | 0               |
  | C(EFH)                  | 1        | 1        | 1        | 0              | 1        | 1              | 1        | 1        | 0               |
  | D(FEH)                  | 1        | 1        | 1        | 1              | 1        | 1              | 1        | 0        | 1               |

- 综上,D选项不属于译码空间内

## 半导体存储芯片的译码驱动方式

- 半导体存储芯片的译码驱动方式有两种:`线选法`和 `重合法`

### 线选法

- 它的特点是用一根 `字选择线`(字线),`直接选中一个存储单元的各位`(如一个字节的各个位) 
- 这种方式结构较简单,但只适于容量不大的存储芯片 
  - 4.19 是一个 16×1 `字节线选法`存储芯片的结构示意图 
  - 如当地址线 $A_{3}A_{2}A_{1}A_{0}$ 为 1111 时,则第 15 根字线被选中,对应下图中的最后一行 8 位代码便可直接读出或写入 

### 重合法

- 由于被选单元是由 X、Y 两个方向的地址决定的,故称为重合法 
  - 4.10 是一个 1K×1 位重合法结构示意图 
  - 显然,只要用 64 根选择线(X、Y 两个方向各 32 根),便可选择 32×32 矩阵中的 `任一位` 
  - 例如,当地址线为全 0 时,译码输出 X 和 Y 有效,矩阵中第 0 行、第 О 列共同选中的那位即被选中 
  - 当欲构成 1K×1 字节的存储器时,只需用 8 片即可 

![🥰03/06/2022 13:38:03](https://img-blog.csdnimg.cn/img_convert/dc251b1dc10126df2f00de07198f8da5.png)

## 存储器与 CPU 的连接🎈



### 合理选择存储芯片

- 要组成一个主存系统,选择存储芯片是第一步,主要指
  - 存储芯片的类型(RAM 或 ROM)
  - 芯片数量
-  ROM 存放**系统程序**、**标准子程序**和**各类常数**
- RAM 则是为用户编程而设置的
- 考虑芯片数量时,要尽量使<u>连线简单、方便</u> 

### 地址线的连接

- 存储芯片的容量不同,其**地址线数**也不同,而 CPU 的地址线数往往比存储芯片的地址线数要多 
- 将 CPU `地址线的低位`与存储芯片的 `地址线`相连,以选择芯片中的某一单元(字选)
  - `这部分的译码是由芯片的片内逻辑完成的` 

- 将 `CPU地址线的高位`则在 `扩充存储芯片`时使用
  - 用来 `选择存储芯片（片选)`,`这部分译码由外接译码器逻辑完成` 


### 数据线的连接

- CPU 的数据线数与存储芯片的数据线数不一定相等,
  - 在相等时可直接相连;
  - 在不等时必须对存储芯片扩位,使其数据位数与 CPU 的数据线数相等 


### 读写命令线的连接

- CPU 读/写命令线一般可<u>直接与存储芯片的读/写控制端相连</u>, 
  - 通常高电平为读,
  -  低电平为写 

- 有些 $\mathrm{CPU}$ 的读/写命令线是分开的
  - 读为 $\overline{RD}$(read), 写为  $\overline{WE}$(write) , 均为低电平有效
  - 此时 $\mathrm{CPU}$ 的读命令线应与存储芯片的允许读控制端相连,
  - 而 CPU 的写命令线则应与存储芯片的允许写控制端相连 


### 片选线的连接

- 片选线的连接是 CPU 与存储芯片连接的关键 
- 存储器由许多存储芯片叠加而成
  - 哪一片被选中完全取决于该存储芯片的片选控制端 $\overline{CS}$ 是否能接收到来自 CPU 的片选有效信号 

- 片选有效信号与 CPU 的 `访存控制信号`$\overline{MREQ}$(MemoryRequst)(低电平有效)有关,
  - 因为只有当 CPU 要求访存时,才要求选中存储芯片 
  - 若 CPU 访问外设IO,则 $\overline{MREQ}$ 为高,表示不要求存储器工作 


### 芯片引脚缩写参考🎆

- [Pin Name Abbreviations - Using Altium Documentation
  https://techdocs.altium.com › files › wiki_attachments](https://techdocs.altium.com/sites/default/files/wiki_attachments/296759/PinAbbreviations.pdf)

### 示例

![🥰03/06/2022 15:49:29](https://img-blog.csdnimg.cn/img_convert/6530554c21da370b38fbe48b2eca94ac.png)
![🥰03/06/2022 15:53:13](https://img-blog.csdnimg.cn/img_convert/63c3b7e594c4930d897e9e4c5b544b22.png)

> 注意到存储是按照字节编址,容量是(范围\*8bit)
>
> 也不是必须要将十六进制转换为二进制(可以直接执行十六进制的减法运算:$67FFH-6000H+1=800H=2^{11}=2\times2^{10}$=2k
>
> 类似的,$6BFFH-6800H+1=400H=2^{10}H=1k$
> 此处+1是因为此处范围为闭区间,包括起始地址
>
> - 不过,要写成二进制形式的时候,在标注坐标的时候,每一段的首尾可以标注一下,可以这样分配:
>   - LHS=[$A_0,A_4,A_7,A_8,A_{12}$]
>   - RHS=[$A_3,A_7,A11,A15$]

- 但是在画片选逻辑图的时候,需要结合cpu地址线的高位部分以及要求的寻址范围,得出哪些cpu地址线需要保持高电平/低电平,从而便于接入特定的地址译码器(驱动其)进行片选


- 另外我们可以从二进制形式中方便的看出$A_{11},A_{12},A_{13}$的规律,即他们除了$A_{11}$外,其余都保持不变(分别是$A_{12}=0,A_{13}=1$);如此一来,就可以确定$A_{13},A_{12},A_{11}$(高位到低位分别是100,101这两种可能(十进制就是4,5;所以最终在连接译码器输出端的时候,我们接入的是$Y_{4},Y_{5}$而不是其他的译码器输出))


![img](https://img-blog.csdnimg.cn/img_convert/9672f88e134e4c7b41f60731b0c0bff7.png)

* 第一片存储芯片用作系统空间,寻址空间需要11条地址线才能够充分利用该芯片的存储单元
* 第二部分是有两片小的4位芯片组合成一个整体上有8位字长的芯片组,然而位扩展不会增加寻址范围,因此和扩展前的地址线要求一致,仅需要10条地址线
* $\overline{MREQ}$端:注意,cpu上的访存控制信号$\overline{MREQ}$和$A_{14}$的始终保持低电平不同,在需要访存的时候,$\overline{MREQ}$信号(低电平有效/触发,所以型号名上有overline)才会呈现低电平,从而达到只在需要访存的时候驱动地址译码器进行存储芯片片选
* $A_{12},A_{13},A_{14}$这几条地址本质上和其他地址线没有什么不同(是指,如果该cpu接入的存储系统(芯片不通过小芯片扩展而成,而是同一块芯片的时候,这些地址线仍然以同样的方式工作))
  * 当然,这里被用来接入片选译码器,但是译码器应该对于这几条线是透明的.
* 关键在于图中的与非门(用于控制片选RAM部分(芯片组))
  * 由于ROM和RAM属于的是字扩展(而非位扩展),所以他们不能同时被选中
  * 而$A_{10}$比较独特,因为ROM芯片片内地址需要11条线(也就是需要$A_{10}$,但是RAM片内并用不上$A_{10}$)(本例中,存储扩展后,可寻址地址范围不连续)
  * guess:
    * 我们要让$A_{10}$有效(高电平)的时候只访问ROM,而不访问RAM
    * 又,译码器$\overline{Y_{5}}$为低电平的时候有效,故当$A_{10},\overline{Y_{5}}$均为低电平的时候才选中RAM(书上的说明是用了与门),RAM也是电平有效(选中)
* 
* ![img](https://img-blog.csdnimg.cn/img_convert/a298068298c00a36b960f56a092d7d05.png)
* 后两个芯片构成一组(字长的扩展(也就是为扩展),来匹配机器 cpu 字长)(执行为扩展的时候,注意数据线(D线)的划分:高位部分和低位部分分别连接到不同的被位扩展的芯片上,同时所有成员芯片被同时片选中(是通过该位扩展芯片组的被选中而同时选所有成员 ))
* 一般各个存储芯片都有自己的使能端(片选$\overline{CS}$(ChipSelect))(和存储芯片的地址线以及数据线都是不同的)