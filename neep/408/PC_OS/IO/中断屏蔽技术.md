@[toc]
#  多重中断和中断屏蔽技术


- 中断屏蔽技术主要用于多重中断。CPU 要具备多重中断的功能，必须满足下列条件:
- 在中断服务程序中提前设置开中断指令。
- 优先级别高的中断源有权中断优先级别低的中断源。
- 关于中断屏蔽字的设置及多重中断程序执行的轨迹，下面通过实例说明





### 例

- 设某机有4个中断源A、B、C、D，其硬件排队优先次序为A>B>C>D,现要求
  将中断处理次序改为D>A>C>B。
  1)写出每个中断源对应的屏蔽字
  2）根据时间轴给出的4个中断源的请求时刻，画出CPU执行程序的轨迹(**程序(p)-时间(t)**图像)(设每个中断源的中断服务程序时间长头20us)
  - 4个中断源对应的请求时刻:
    - B:5
    - D:10
    - A:35
    - C:60

- 解

  - 1)在中断处理次序改为<u>D>A>C>B</u>后,逐个分析屏蔽情况

    - D具有最高优先级

      - 可以<u>屏蔽其他所有中断</u>，且<u>不能中断自身</u>，(即屏蔽D,A,C,B全部)
      - 因此D对应的屏蔽字为1111;

    - A屏蔽A,C,B,

      - A对各个中断源的屏蔽二进制代码
        - A:1
        - B:1
        - C:1
        - D:0
      - 因此A对应的屏蔽字为1110，

    - C屏蔽C,B

      - C对各个中断源的屏蔽二进制代码:
        - A:0
        - B:1
        - C:1
        - D:0
      - C的屏蔽字为0110

    - B屏蔽自身(B)

      - B:1
      - 其余全为1
      - B的屏蔽字为0100

      

- 2）根据中断源发出请求的时间顺序以及处理不同中断源的优先级进行多重中断分析
  - 在时刻5，B发中断请求，获得CPU;
  - 在时刻10，D发中断请求，
    - 5~10时间段内,cpu执行了5us的任务B
    - 此时B还未执行完毕(还需要15=20-5)us，
    - 根据处理优先级,D的优先级高于B，于是D中断B而获得CPU;
    - D占用20us(此时时间线到了10+20=30us)完成任务后范围到B的中断程序处继续执行
  - 在时刻30，D执行完毕，B继续获得CPU
  - 时刻35,A发出中断请求
    - 30~35时间段内,cpu执行了5us的任务B
    - 此时B还未执行完毕(还需要15-5=10us)
    - 根据处理优先级,A的优先级更高,
    - 于是A中断B而获得CPU;
    - 由于下一个中断信号是在时刻60到达,60-35=25>20
    - 即A的任务可以完成,而且还有盈余的时间回到被A中断的B串继续执行25-20=5us的时间
  - 时刻55(=35+20),A执行完毕
    - 回到B执行
  - 时刻60,C发出中断
    - 55~60时间段,cpu执行了5us的任务B
    - 此时B还未结束(还有10-5=5us)
    - 但是C优先级更高,C中断B(抢夺了B的cpu资源)
    - C发出的是最后一个中断信号
    - 知道执行完毕(耗时20us)
    - 回到被中断的B任务
  - 时刻80=(60+20),C任务结束
    - 回到被C中断的断点继续执行B
    - 此时B还需要5us,
    - 因此到了时刻85,结束全部任务
  - ![在这里插入图片描述](https://img-blog.csdnimg.cn/1c21dc7699164cf5b08329a39e1aeba8.png)
    - 纵坐标就按照字母顺序从低到高升序排列即可
  - ![在这里插入图片描述](https://img-blog.csdnimg.cn/20210623220226474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h1Y2hhb3hpbjEzNzU=,size_16,color_FFFFFF,t_70)



